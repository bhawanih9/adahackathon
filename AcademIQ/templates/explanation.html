{% extends 'base.html' %}

{% block content %}
<div class="explanation-container fade-in">
    <header class="page-header">
        <h1>Concept: <span class="highlight">{{ data.topic }}</span></h1>
    </header>

    <div class="grid-layout">
        <div class="card content-card full-width">
            <h3><i class="fas fa-language"></i> Kannada Explanation</h3>
            <p id="kannada-text-content" class="kannada-text">{{ data.kannada_explanation }}</p>
            <div class="audio-control">
                <button class="btn-small" onclick="startAudio()" id="btn-play" title="Play"><i
                        class="fas fa-play"></i></button>
                <button class="btn-small" onclick="pauseAudio()" id="btn-pause" title="Pause"><i
                        class="fas fa-pause"></i></button>
                <button class="btn-small" onclick="stopAudio()" id="btn-stop" title="Stop"><i
                        class="fas fa-stop"></i></button>
            </div>
        </div>

        <script>
            let utterance = null;

            function startAudio() {
                // If paused, resume
                if (window.speechSynthesis.paused) {
                    window.speechSynthesis.resume();
                    return;
                }
                // If speaking, do nothing (or restart?) - let's restart if already speaking different text, but here just return
                if (window.speechSynthesis.speaking) return;

                const text = document.getElementById('kannada-text-content').innerText;
                utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'kn-IN';
                window.speechSynthesis.speak(utterance);
            }

            function pauseAudio() {
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.pause();
                }
            }

            function stopAudio() {
                window.speechSynthesis.cancel();
            }
        </script>

        <div class="card content-card">
            <h3><i class="fas fa-calculator"></i> Formula</h3>
            <div class="formula-box">
                {{ data.formula }}
            </div>
        </div>

        <div class="card content-card">
            <h3><i class="fas fa-lightbulb"></i> Real-life Example</h3>
            <p>{{ data.example }}</p>
        </div>
    </div>

    <div class="action-bar mt-20">
        <a href="{{ url_for('diagram') }}" class="btn-primary">See Diagram</a>
        <a href="{{ url_for('practice') }}" class="btn-secondary-outline">Practice Questions</a>
    </div>
</div>

<style>
    .grid-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
    }

    .full-width {
        grid-column: 1 / -1;
    }

    .content-card {
        width: 100%;
        /* Override fixed width from style.css */
        align-items: flex-start;
        text-align: left;
    }

    .kannada-text {
        font-size: 1.2rem;
        line-height: 1.6;
        margin: 15px 0;
        color: #dfe6e9;
    }

    .formula-box {
        font-family: 'Courier New', monospace;
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
        font-size: 1.2rem;
        color: var(--accent-color);
    }

    .btn-small {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    .action-bar {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 40px;
    }

    .btn-secondary-outline {
        border: 2px solid var(--secondary-color);
        color: var(--secondary-color);
        padding: 10px 30px;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-secondary-outline:hover {
        background: var(--secondary-color);
        color: var(--dark-bg);
    }
</style>
{% endblock %}