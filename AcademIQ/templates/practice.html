{% extends 'base.html' %}

{% block content %}
<div class="practice-container fade-in center-box" style="max-width: 800px; padding-bottom: 50px;">
    <h1>Quick <span class="highlight">Check</span> (5 Questions)</h1>

    {% for question in questions %}
    <div class="question-card mt-20">
        <h3>Question {{ loop.index }}:</h3>
        <p class="question-text">{{ question.question }}</p>

        <div class="options-grid">
            {% for option in question.options %}
            <button class="option-btn btn-group-{{ question.id }}"
                onclick="checkAnswer('{{ option }}', '{{ question.id }}')">{{ option }}</button>
            {% endfor %}
        </div>

        <div id="feedback-{{ question.id }}" class="feedback-box hidden">
            <h4 id="feedback-title-{{ question.id }}"></h4>
            <p id="feedback-text-{{ question.id }}"></p>
        </div>
    </div>
    {% endfor %}

    <div class="text-center mt-20">
        <a href="{{ url_for('summary') }}" class="btn-primary">Finish & See Summary</a>
    </div>
</div>

<script>
    function checkAnswer(selectedOption, qId) {
        const formData = new FormData();
        formData.append('answer', selectedOption);
        formData.append('q_id', qId);

        fetch('/check_answer', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                const feedbackBox = document.getElementById(`feedback-${qId}`);
                const feedbackTitle = document.getElementById(`feedback-title-${qId}`);
                const feedbackText = document.getElementById(`feedback-text-${qId}`);
                // Target only buttons for THIS question
                const buttons = document.querySelectorAll(`.btn-group-${qId}`);

                feedbackBox.classList.remove('hidden');
                feedbackBox.className = 'feedback-box ' + (data.correct ? 'success' : 'error');

                feedbackTitle.innerText = data.correct ? 'Correct! ðŸŽ‰' : 'Incorrect ðŸ˜”';
                feedbackText.innerText = data.feedback;

                // Disable buttons for this question
                buttons.forEach(btn => btn.disabled = true);
            });
    }
</script>

<style>
    .question-card {
        background: var(--glass-bg);
        padding: 30px;
        border-radius: 15px;
        border: 1px solid var(--glass-border);
    }

    .question-text {
        font-size: 1.2rem;
        margin-bottom: 25px;
    }

    .options-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .option-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        padding: 15px;
        color: white;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.2s;
    }

    .option-btn:hover:not(:disabled) {
        background: rgba(255, 255, 255, 0.15);
    }

    .option-btn:disabled {
        cursor: not-allowed;
        opacity: 0.6;
    }

    .feedback-box {
        margin-top: 25px;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
    }

    .feedback-box.success {
        background: rgba(46, 204, 113, 0.2);
        border: 1px solid #2ecc71;
    }

    .feedback-box.error {
        background: rgba(231, 76, 60, 0.2);
        border: 1px solid #e74c3c;
    }
</style>
{% endblock %}